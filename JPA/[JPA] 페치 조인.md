## 페치 조인(Fetch Join)이란?

페치 조인은 JPQL에서 제공하는 성능 최적화 기능으로, 연관된 엔티티나 컬렉션을 SQL 한 번에 함께 조회하는 기능이다.

```sql
select m from Member m inner join fetch m.team
```

- SQL 조인 종류가 아님
- JPQL에서 성능 최적화를 위해 제공하는 기능
- 연관된 엔티티나 컬렉션을 SQL 한 번에 함께 조회하는 기능
- join fetch 명령어로 사용할 수 있음
- `[LEFT [OUTER] | INNER] JOIN FETCH <조인 경로>`

## 페치 조인 vs 일반 조인

1. 페치 조인
	- 조회의 주체가 되는 엔티티와 페치 조인이 걸린 연관 엔티티 모두 함께 select하여 영속화
	- 페치 타입이 LAZY인 엔티티를 참조해도 이미 영속성 컨텍스트에 로드되어 있어 추가 쿼리 없이 N + 1 문제를 해결할 수 있다.
2. 일반 조인
	- 연관 엔티티에 조인을 걸어도 실제 select하는 엔티티는 JPQL에서 조회하는 주 엔티만 조회하여 영속화한다.
	- 데이터는 필요하지 않지만 연관 엔티티가 검색 조건에 필요한 경우에 주로 사용된다.


## 장점 및 주의사항

### 장점

1. N + 1 문제 해결: 연관 엔티티를 함께 조회하여 추가 쿼리 발생을 방지한다.
2. 성능 최적화: 한 번의 쿼리로 필요한 데이터를 모두 조회하여 성능을 향상시킨다.
3. 즉시 로딩 효과: LAZY로 설정된 연관 관계도 함께 조회하여 즉시 로딩과 같은 효과를 얻을 수 있다.


### 주의사항

1. 페이징 API 사용 제한: 일대다 관계에서 컬렉션 페치 조인 시 페이징 API를 사용할 수 없음
2. 둘 이상의 컬렉션 페치 조인 사용 불가: 카테시안 곱이 발생하여 데이터 정합성 문제가 생길 수 있음
3. 컬렉션 페치 조인 사용 시 중복 출력
	- ex) 회원 1, 2가 팀A, 회원 3이 팀B에 소속되어 있고, 팀A에 속한 회원의 수를 구하는 쿼리에 컬렉션 페치 조인 사용 시 팀A에 속한 회원의 수만큼 중복 쿼리가 발생할 수 있음
4. 엔티티 그래프 기능 활용: 복잡한 페치 조인의 경우 @EntityGraph를 사용하여 더 유연하 처리 가능